name: Torrent-Gen-2026-Docker
on:
  workflow_dispatch:
    inputs:
      url:
        description: 'Direct Link (Pixeldrain)'
        required: true
        default: 'https://pixeldrain.com'
      name:
        description: 'Torrent Filename'
        required: true
        default: 'pixeldrain_file'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download File
        run: |
          sudo apt-get update && sudo apt-get install -y aria2
          aria2c -x 16 -o "data.file" "${{ github.event.inputs.url }}"

      - name: Create Torrent via Docker
        run: |
          # We mount the current directory to /data inside the container
          # This bypasses all AppImage/FUSE/Ubuntu 24.04 library errors
          docker run --rm -v $(pwd):/data fbdtemme/torrenttools create \
            -v 1 \
            -o "/data/${{ github.event.inputs.name }}.torrent" \
            -w "${{ github.event.inputs.url }}" \
            -a udp://tracker.opentrackr.org:1337/announce \
            "/data/data.file"

      - name: Upload Result
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.name }}
          path: ${{ github.event.inputs.name }}.torrent
